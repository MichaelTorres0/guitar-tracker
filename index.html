<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taylor GS Mini Maintenance Tracker</title>

    <!-- PWA Meta Tags -->
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" sizes="180x180" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Guitar Tracker">
    <meta name="theme-color" content="#3b82f6">
    <meta name="description" content="Track maintenance, humidity, and care for Taylor GS Mini Sapele acoustic guitar">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>üé∏ Guitar Maintenance Tracker</h1>
                <p class="model-badge">Configured for Taylor GS Mini Sapele</p>
                <p style="color: var(--color-text-light); font-size: 13px; margin-top: 4px;">Playing Schedule: 2.5 hrs/week | String Gauge: EJ16 Light (.012-.053)</p>
            </div>
            <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                <div class="offline-indicator">
                    <span class="offline-dot"></span>
                    <span>Offline Ready</span>
                </div>
                <button class="theme-toggle">üåô Dark Mode</button>
            </div>
        </div>

        <!-- ALERTS SECTION -->
        <div id="alertContainer"></div>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-btn active">üìä Dashboard</button>
            <button class="tab-btn">üîß Maintenance Tasks</button>
            <button class="tab-btn">üíß Humidity Log</button>
            <button class="tab-btn">üîç Inspections</button>
            <button class="tab-btn">üì¶ Equipment</button>
            <button class="tab-btn">‚¨áÔ∏è Export & Settings</button>
        </div>

        <!-- DASHBOARD TAB -->
        <div id="dashboard" class="tab-content active">
            <button class="btn-just-played">‚ñ∂Ô∏è Just Played - Log Daily Tasks</button>

            <!-- Restock Alert Banner -->
            <div id="restockAlertBanner" class="restock-alert" style="display: none;"></div>

            <!-- Practice Streak Display -->
            <div id="practiceStreak" style="text-align: center; padding: 12px; background: var(--color-bg); border-radius: 8px; margin-bottom: 20px; font-size: 14px; font-weight: 600;"></div>

            <div class="grid-3">
                <div class="stat-card">
                    <div class="stat-label">Overall Completion</div>
                    <div class="stat-value" id="overallCompletion">0%</div>
                    <div class="progress-bar">
                        <div class="progress-fill color-weekly" id="overallBar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Days Since String Change</div>
                    <div class="stat-value" id="daysSinceChange">‚Äî</div>
                    <div class="stat-label" style="margin-top: 8px; font-size: 11px;">Target: Every 8 weeks (56 days)</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Current Humidity</div>
                    <div class="humidity-display" id="currentHumidity">‚Äî</div>
                    <div class="humidity-status" id="humidityStatus"></div>
                </div>
            </div>

            <div class="string-life-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <h3 style="font-size: 14px; font-weight: 600; margin: 0;">üìä String Life Calculator</h3>
                    <div id="weeklyHours" style="font-size: 12px; color: var(--color-text-light); font-weight: 600;">This week: 0 hrs</div>
                </div>
                <div style="font-size: 12px; color: var(--color-text-light); margin-bottom: 12px;" id="calculatorBasis">Based on 2.5 hrs/week playing + daily cleaning</div>

                <!-- String Health Ring -->
                <div style="display: flex; flex-direction: column; align-items: center; margin: 20px 0;">
                    <svg class="string-health-ring" viewBox="0 0 36 36" id="stringHealthRing">
                        <path class="ring-bg"
                            d="M18 2.0845
                                a 15.9155 15.9155 0 0 1 0 31.831
                                a 15.9155 15.9155 0 0 1 0 -31.831"
                            fill="none"
                            stroke="#374151"
                            stroke-width="3"
                        />
                        <path class="ring-progress" id="ringProgress"
                            d="M18 2.0845
                                a 15.9155 15.9155 0 0 1 0 31.831
                                a 15.9155 15.9155 0 0 1 0 -31.831"
                            fill="none"
                            stroke="#22c55e"
                            stroke-width="3"
                            stroke-dasharray="0, 100"
                            stroke-linecap="round"
                        />
                        <text x="18" y="20.5" text-anchor="middle" class="ring-text" id="ringText">0%</text>
                    </svg>
                    <div style="text-align: center; font-size: 13px; font-weight: 600; margin-top: 8px;" id="stringLifeText">Strings at 0% life</div>
                    <div style="text-align: center; font-size: 12px; color: var(--color-text-light); margin-top: 4px;" id="stringLifeEstimate">‚Äî</div>
                </div>

                <div style="font-size: 11px; color: var(--color-text-light); margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--color-border);">
                    <strong>‚ÑπÔ∏è How it works:</strong> Calculates remaining string life based on your playing schedule and cleaning habits. Adjust playing hours in settings to customize.
                </div>
            </div>

            <div class="grid-2" style="margin-top: 20px;">
                <div class="card">
                    <h3>üéØ Period Completion</h3>
                    <div class="progress-section">
                        <div class="progress-label">
                            <span>Daily Tasks</span>
                            <span id="dailyPercent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill color-daily" id="dailyBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-label">
                            <span>Weekly Tasks</span>
                            <span id="weeklyPercent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill color-weekly" id="weeklyBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-label">
                            <span>8-Week Tasks</span>
                            <span id="eightweekPercent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill color-8week" id="eightweekBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-label">
                            <span>Quarterly Tasks</span>
                            <span id="quarterlyPercent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill color-quarterly" id="quarterlyBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-label">
                            <span>Annual Tasks</span>
                            <span id="annualPercent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill color-annual" id="annualBar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>‚ö†Ô∏è Thresholds & Actions</h3>
                    <div class="threshold-panel">
                        <div class="threshold-item">
                            <span class="threshold-label">Target RH</span>
                            <span class="threshold-value">45-50%</span>
                        </div>
                        <div class="threshold-item">
                            <span class="threshold-label">Safe Range</span>
                            <span class="threshold-value">40-55%</span>
                        </div>
                        <div class="threshold-item">
                            <span class="threshold-label">‚ö†Ô∏è Low Risk</span>
                            <span class="threshold-value">&lt; 40%</span>
                        </div>
                        <div class="threshold-item">
                            <span class="threshold-label">üî¥ High Risk</span>
                            <span class="threshold-value">&gt; 55%</span>
                        </div>
                        <div class="threshold-item">
                            <span class="threshold-label">Rapid Change Alert</span>
                            <span class="threshold-value">&gt; 10% in 24h</span>
                        </div>
                    </div>
                    <div style="font-size: 12px; color: var(--color-text-light); line-height: 1.6;">
                        <strong>Critical Warning:</strong> GS Mini bridge lifting occurs at RH &gt; 55-60%. The solid spruce top swells and pushes bridge wing tips. Repair cost: $150-200. Your Humidipak is preventative maintenance, not optional.
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3>üìÖ Upcoming Maintenance Calendar</h3>
                <div class="calendar-grid" id="maintenanceCalendar"></div>
            </div>
        </div>

        <!-- MAINTENANCE TASKS TAB -->
        <div id="maintenance" class="tab-content">
            <div id="maintenanceContainer"></div>
        </div>

        <!-- HUMIDITY LOG TAB -->
        <div id="humidity" class="tab-content">
            <div class="grid-2">
                <div class="card">
                    <h3>üìù Log Humidity Reading</h3>
                    <div class="humidity-reference">
                        <span class="ref-target">45-50% Target</span>
                        <span class="ref-safe">40-55% Safe</span>
                        <span class="ref-warning">&lt;40% Low</span>
                        <span class="ref-danger">&gt;55% High</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Relative Humidity (%)</label>
                        <input type="number" id="humidityValue" min="0" max="100" step="0.1" placeholder="e.g., 48.5">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Temperature (¬∞F) - Optional</label>
                        <input type="number" id="temperatureValue" step="0.1" placeholder="e.g., 72">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Guitar Location</label>
                        <select id="guitarLocation">
                            <option value="case">In Case</option>
                            <option value="out">Out of Case</option>
                        </select>
                    </div>
                    <button id="addHumiditySimplified" class="btn-primary" style="width: 100%;">üìç Log Reading Now</button>
                    <div id="humidityFeedback" class="form-feedback" style="display: none;"></div>
                    <div id="logConfirmation" class="form-feedback success" style="display: none;">‚úÖ Reading logged successfully</div>
                </div>

                <div class="card">
                    <h3>üìä Humidity Statistics</h3>
                    <div class="stat-card" style="margin-bottom: 12px;">
                        <div class="stat-label">Latest Reading</div>
                        <div class="stat-value" id="latestHumidity">‚Äî</div>
                        <div class="stat-label" style="margin-top: 8px;" id="latestTime">‚Äî</div>
                    </div>
                    <div class="stat-card" style="margin-bottom: 12px;">
                        <div class="stat-label">
                            24h Change
                            <span class="info-icon" title="Click for info" onclick="showHumidityTrendInfo()">‚ìò</span>
                        </div>
                        <div class="stat-value" id="humidity24hChange" style="font-size: 20px;">‚Äî</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Range (Last 7 Days)</div>
                        <div style="font-size: 14px; margin-top: 8px;">
                            <div style="margin-bottom: 8px;">High: <strong id="humidity7dHigh">‚Äî</strong></div>
                            <div>Low: <strong id="humidity7dLow">‚Äî</strong></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="humidityChartContainer" class="card" style="margin-top: 20px; display: none;">
                <h3>üìà 7-Day Humidity Trend</h3>
                <canvas id="humidityChart" style="max-height: 250px;"></canvas>
                <div style="font-size: 11px; color: var(--color-text-light); margin-top: 12px; text-align: center;">
                    üü¢ Safe (40-50%) | üü° Caution (30-40%, 50-55%) | üî¥ Danger (55-65%)
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3>üìä Humidity History</h3>

                <!-- Filter Controls -->
                <div class="filter-controls" style="background: var(--color-bg); padding: 12px; border-radius: 6px; margin-bottom: 16px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 12px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">From Date:</label>
                            <input type="date" id="filterDateFrom" style="width: 100%;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">To Date:</label>
                            <input type="date" id="filterDateTo" style="width: 100%;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Location:</label>
                            <select id="filterLocation" style="width: 100%;">
                                <option value="all">All Locations</option>
                                <option value="case">In Case</option>
                                <option value="out">Out of Case</option>
                            </select>
                        </div>
                    </div>
                    <div class="button-group" style="margin-top: 0;">
                        <button id="applyFilters" class="btn-primary">Apply Filters</button>
                        <button id="clearFilters" class="btn-secondary">Clear</button>
                        <button id="exportFiltered" class="btn-secondary">Export Filtered</button>
                    </div>
                </div>

                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>RH %</th>
                                <th>Temp ¬∞F</th>
                                <th>Status</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="humidityTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- INSPECTIONS TAB -->
        <div id="inspection" class="tab-content">
            <div class="card">
                <h3>üîç Guided Inspection Checklists</h3>
                
                <div style="margin-top: 20px;">
                    <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Weekly: Bridge Wing Lift Check</h4>
                    <div id="bridgeCheckResult" style="font-size: 11px; color: var(--color-text-light); margin-bottom: 8px; padding: 6px; background: var(--color-bg); border-radius: 4px; display: none;"></div>
                    <div class="checklist-item">
                        <input type="checkbox" id="bridgeCheck1" onchange="recordInspection('bridge', 'weekly')">
                        <div class="checklist-content">
                            <div class="checklist-label">Inspect bridge wings visually</div>
                            <div class="checklist-note">Look closely where bridge wings meet the top. Any gaps = emergency situation requiring immediate Humidipak replacement.</div>
                        </div>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="bridgeCheck2" onchange="recordInspection('bridge', 'weekly')">
                        <div class="checklist-content">
                            <div class="checklist-label">Gently press bridge wings</div>
                            <div class="checklist-note">Should feel firm and flush to top. Soft or gaps indicate humidity swelling and require action.</div>
                        </div>
                    </div>
                    <button id="openBridgeModal" class="btn-secondary" style="width: 100%; margin-top: 12px;">If Detected ‚Üí Recommended Actions</button>
                </div>

                <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--color-border);">

                <div style="margin-top: 20px;">
                    <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Quarterly: Action & Buzzing Check</h4>
                    <div id="actionCheckResult" style="font-size: 11px; color: var(--color-text-light); margin-bottom: 8px; padding: 6px; background: var(--color-bg); border-radius: 4px; display: none;"></div>
                    <div class="checklist-item">
                        <input type="checkbox" id="actionCheck1" onchange="recordInspection('action', 'quarterly')">
                        <div class="checklist-content">
                            <div class="checklist-label">Measure action at 12th fret</div>
                            <div class="checklist-note">Use straightedge or business card. <span class="gs-mini-spec" title="Taylor GS Mini specification">High E: 1.5-2mm, Low E: 2-2.5mm</span> from fret top.</div>
                        </div>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="actionCheck2" onchange="recordInspection('action', 'quarterly')">
                        <div class="checklist-content">
                            <div class="checklist-label">Listen for buzzing</div>
                            <div class="checklist-note">Play each fret softly. If buzzing occurs consistently, neck relief may need adjustment.</div>
                        </div>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="actionCheck3" onchange="recordInspection('action', 'quarterly')">
                        <div class="checklist-content">
                            <div class="checklist-label">Check for dead spots</div>
                            <div class="checklist-note">Play chords across neck. Uneven sustain or sudden drops indicate action or intonation issues.</div>
                        </div>
                    </div>
                    <button id="openActionModal" class="btn-secondary" style="width: 100%; margin-top: 12px;">If Detected ‚Üí Recommended Actions</button>
                </div>

                <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--color-border);">

                <div style="margin-top: 20px;">
                    <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Every String Change: Fret Feel Check</h4>
                    <div id="fretCheckResult" style="font-size: 11px; color: var(--color-text-light); margin-bottom: 8px; padding: 6px; background: var(--color-bg); border-radius: 4px; display: none;"></div>
                    <div class="checklist-item">
                        <input type="checkbox" id="fretCheck1" onchange="recordInspection('fret', 'stringchange')">
                        <div class="checklist-content">
                            <div class="checklist-label">Slide finger down frets</div>
                            <div class="checklist-note">Should feel smooth and polished. Rough or gritty feel indicates tarnish or oxidation.</div>
                        </div>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="fretCheck2" onchange="recordInspection('fret', 'stringchange')">
                        <div class="checklist-content">
                            <div class="checklist-label">Inspect all 20 frets visually</div>
                            <div class="checklist-note">Look for dull appearance or roughness. Tarnished frets cause string degradation and gritty bends.</div>
                        </div>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="fretCheck3" onchange="recordInspection('fret', 'stringchange')">
                        <div class="checklist-content">
                            <div class="checklist-label">Check for fret sprout</div>
                            <div class="checklist-note">Look at fretboard edges. Sharp fret ends protruding indicate humidity drying. Requires professional truss rod adjustment.</div>
                        </div>
                    </div>
                    <button id="openFretModal" class="btn-secondary" style="width: 100%; margin-top: 12px;">If Detected ‚Üí Recommended Actions</button>
                </div>

                <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--color-border);">

                <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; margin-top: 20px;">Safety Alerts: Product Use</h4>
                <div style="background: rgba(239, 68, 68, 0.1); border-left: 4px solid var(--color-error); padding: 12px; border-radius: 4px; margin-bottom: 12px;">
                    <strong style="color: var(--color-error);">‚ùå DO NOT USE:</strong>
                    <ul style="margin-top: 8px; padding-left: 20px; font-size: 13px; color: var(--color-text-light);">
                        <li>Lemon oil or generic wood oils (use only F-ONE)</li>
                        <li>Steel wool on body (scratches finish)</li>
                        <li>Silicone-based polishes (contaminates wood)</li>
                        <li>Compressed air (blows dust into sensitive areas)</li>
                        <li>Furniture polishes (damages guitar finishes)</li>
                        <li>Over-oil ebony fretboard (permanent darkening, fret loosening)</li>
                    </ul>
                </div>
                <div style="background: rgba(16, 185, 129, 0.1); border-left: 4px solid var(--color-success); padding: 12px; border-radius: 4px;">
                    <strong style="color: var(--color-success);">‚úÖ USE ONLY:</strong>
                    <ul style="margin-top: 8px; padding-left: 20px; font-size: 13px; color: var(--color-text-light);">
                        <li>GRIP Guards with FRINE for fret polishing</li>
                        <li>Guitar ONE Polish & Cleaner (all finishes)</li>
                        <li>F-ONE Fretboard Oil (ebony-safe)</li>
                        <li>String Fuel for string cleaning</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- EQUIPMENT INVENTORY TAB -->
        <div id="inventory" class="tab-content">
            <!-- Consumables Inventory -->
            <div class="card" style="margin-bottom: 20px;">
                <h3>üì¶ Consumables Inventory</h3>
                <p style="font-size: 13px; color: var(--color-text-light); margin-bottom: 16px;">Track strings, picks, cleaning supplies, and other consumables. Items linked to tasks will prompt for auto-decrement when you complete those tasks.</p>

                <button id="addInventoryItemBtn" class="btn-primary" style="width: 100%; margin-bottom: 16px;" onclick="window.showInventoryModal()">+ Add Item</button>

                <div id="inventoryList"></div>
            </div>

            <!-- Equipment Checklist -->
            <div class="card">
                <h3>üé∏ Equipment Inventory</h3>
                <p style="font-size: 13px; color: var(--color-text-light); margin-bottom: 16px;">Manage your guitar care equipment. Add, edit, or remove items as needed.</p>

                <div id="inventoryChecklist"></div>

                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--color-border);">
                    <h4 style="font-size: 13px; font-weight: 600; margin-bottom: 12px;">‚ö†Ô∏è Equipment You Need to Add</h4>
                    <div class="checklist-item">
                        <input type="checkbox" id="backup-hygrometer" class="priority-item" data-priority="1">
                        <div class="checklist-content">
                            <div class="checklist-label">Backup Hygrometer ($10-15)</div>
                            <div class="checklist-note">If your Inkbird fails, you won't know your guitar is in danger. Purchase within next month.</div>
                        </div>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="light-strings" class="priority-item" data-priority="1">
                        <div class="checklist-content">
                            <div class="checklist-label">Light Gauge Strings (EJ16, .012-.053)</div>
                            <div class="checklist-note">Keep backup set on hand. If ANY bridge movement detected, immediate string tension reduction prevents $150-200 repair.</div>
                        </div>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="string-cleaner-tool" class="priority-item" data-priority="2">
                        <div class="checklist-content">
                            <div class="checklist-label">String Cleaner Tool ($15-20) - Optional</div>
                            <div class="checklist-note">Mechanical 360-degree cleaner. Your String Fuel works well; this is for extra-thorough cleaning if you have acidic sweat.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- EXPORT & SETTINGS TAB -->
        <div id="export" class="tab-content">
            <div class="grid-2">
                <div class="card">
                    <h3>üíæ Backup & Restore</h3>
                    <div id="backupStatus" style="background: var(--color-bg); padding: 10px; border-radius: 6px; margin-bottom: 12px; font-size: 12px; color: var(--color-text-light);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span>Last backup:</span>
                            <span id="lastBackupDate">Never</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Data size:</span>
                            <span id="dataSize">Calculating...</span>
                        </div>
                    </div>
                    <button id="createBackup" class="btn-primary" style="width: 100%; margin-bottom: 10px;">Create Backup</button>
                    <div id="backupConfirmation" class="form-feedback success" style="display:none;">
                        ‚úÖ Backup created successfully!
                    </div>

                    <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--color-border);">

                    <h4 style="font-size: 14px; margin-bottom: 12px;">Restore from Backup</h4>
                    <p class="warning-text" style="font-size: 12px; color: var(--color-warning); margin-bottom: 12px;">‚ö†Ô∏è This will replace all current data</p>
                    <input type="file" id="restoreFile" accept=".json" style="display:none;">
                    <button id="restoreBackup" class="btn-secondary" style="width: 100%;">Choose Backup File...</button>
                    <div id="restoreConfirmation" class="form-feedback" style="display:none;"></div>
                </div>

                <div class="card">
                    <h3>‚¨áÔ∏è Export Data</h3>
                    <p style="font-size: 13px; color: var(--color-text-light); margin-bottom: 16px;">Export your maintenance history and humidity logs for backup or analysis.</p>
                    <button id="exportCSV" class="btn-primary" style="width: 100%; margin-bottom: 10px;">üìä Export as CSV</button>
                    <button id="exportJSON" class="btn-secondary" style="width: 100%;">üíæ Backup as JSON</button>

                    <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--color-border);">

                    <h4 style="font-size: 14px; margin-bottom: 12px;">Reset & Manage</h4>
                    <button id="resetDaily" class="btn-secondary" style="width: 100%; margin-bottom: 10px;">‚Üª Reset Daily Tasks</button>
                    <button id="resetWeekly" class="btn-secondary" style="width: 100%; margin-bottom: 10px;">‚Üª Reset Weekly Tasks</button>
                    <button id="resetAll" class="btn-danger" style="width: 100%;">‚ö†Ô∏è Clear All Data</button>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3>üé∏ Guitar Settings</h3>
                <p style="font-size: 13px; color: var(--color-text-light); margin-bottom: 16px;">Update your guitar's configuration and string information.</p>

                <div class="form-group">
                    <label class="form-label">Current String Type</label>
                    <input type="text" id="currentStringType" placeholder="e.g., D'Addario EJ16 Phosphor Bronze Light (.012-.053)">
                    <div style="font-size: 11px; color: var(--color-text-light); margin-top: 4px;">This will be displayed in the header</div>
                </div>

                <div class="form-group" style="margin-top: 16px;">
                    <label class="form-label">Last String Change Date</label>
                    <input type="date" id="lastStringChangeDate">
                    <div style="font-size: 11px; color: var(--color-text-light); margin-top: 4px;">Used to calculate days since string change</div>
                </div>

                <button id="saveGuitarSettings" class="btn-primary" style="width: 100%; margin-top: 16px;">Save Settings</button>
                <div id="settingsSavedConfirmation" class="form-feedback success" style="display:none; margin-top: 12px;">
                    ‚úÖ Settings saved successfully!
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3>üìã Create Reminders (Manual Steps)</h3>
                <p style="font-size: 13px; color: var(--color-text-light); margin-bottom: 16px;">
                    Since this app runs in your browser, you can manually create reminders in:
                </p>
                <div style="background: var(--color-bg); padding: 12px; border-radius: 4px; margin-bottom: 12px;">
                    <strong>Option 1: Google Calendar</strong>
                    <ul style="margin-top: 8px; padding-left: 20px; font-size: 13px; color: var(--color-text-light); line-height: 1.6;">
                        <li><strong>Daily:</strong> "Guitar maintenance - String cleaning & case check" at 5:00 PM (after playing)</li>
                        <li><strong>Weekly:</strong> "Guitar inspection - Hardware, bridge, Humidipak check" every Sunday at 2:00 PM</li>
                        <li><strong>Every 8 weeks:</strong> "String change & deep clean" with 2-week advance reminder</li>
                        <li><strong>Quarterly:</strong> "Truss rod observation & structural inspection"</li>
                        <li><strong>Annual:</strong> "Taylor Refresh service appointment" ($115)</li>
                    </ul>
                </div>
                <div style="background: var(--color-bg); padding: 12px; border-radius: 4px;">
                    <strong>Option 2: Phone Reminders</strong>
                    <ul style="margin-top: 8px; padding-left: 20px; font-size: 13px; color: var(--color-text-light); line-height: 1.6;">
                        <li>Create recurring alerts for standard times that match your schedule</li>
                        <li>Use voice reminders for additional detail (e.g., "Check humidity now")</li>
                    </ul>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3>üìú String Change History</h3>
                <div id="stringHistoryDisplay">
                    <p class="empty-state" style="padding: 20px; text-align: center;">No string changes logged yet</p>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3>üìñ Quick Reference: Your Maintenance Calendar</h3>
                <div style="font-size: 13px; color: var(--color-text-light); line-height: 1.8;">
                    <p><strong>After Every Session (5 min):</strong></p>
                    <ul style="padding-left: 20px; margin-bottom: 12px;">
                        <li>String cleaning</li>
                        <li>Body wipedown</li>
                        <li>Humidity check</li>
                    </ul>
                    <p><strong>Weekly (5 min):</strong></p>
                    <ul style="padding-left: 20px; margin-bottom: 12px;">
                        <li>Hardware oxidation check</li>
                        <li>Bridge wing monitoring</li>
                        <li>Humidipak packet check</li>
                    </ul>
                    <p><strong>Every 8 Weeks (60 min):</strong></p>
                    <ul style="padding-left: 20px; margin-bottom: 12px;">
                        <li>String change & fret polishing (FRINE)</li>
                        <li>Fretboard conditioning (if dry)</li>
                        <li>Nut/saddle lubrication</li>
                        <li>Bridge pin cleaning</li>
                        <li>Full body detail & hardware polish</li>
                    </ul>
                    <p><strong>Quarterly (15 min):</strong></p>
                    <ul style="padding-left: 20px; margin-bottom: 12px;">
                        <li>Humidipak replacement</li>
                        <li>Truss rod observation</li>
                        <li>Complete structural inspection</li>
                    </ul>
                    <p><strong>Annual:</strong></p>
                    <ul style="padding-left: 20px;">
                        <li>Taylor "Refresh" Service Package ($115)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="bridgeModal" class="modal">
        <div class="modal-content">
            <button id="closeBridgeModalX" class="modal-close">&times;</button>
            <div class="modal-header">üî¥ Bridge Wing Lift Detected</div>
            <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--color-error);">EMERGENCY ACTION REQUIRED</h3>
            <div style="font-size: 13px; color: var(--color-text-light); line-height: 1.6;">
                <p style="margin-bottom: 12px;"><strong>This is a critical situation.</strong> Bridge lifting indicates humidity swelling affecting the solid spruce top.</p>
                
                <h4 style="font-weight: 600; margin-top: 16px; margin-bottom: 8px;">Immediate Actions (Next 24 hours):</h4>
                <ol style="padding-left: 20px;">
                    <li>Replace Humidipak packets immediately‚Äîdon't wait</li>
                    <li>Reduce room humidity with dehumidifier (target 45-50% RH)</li>
                    <li>Keep guitar in case with new Humidipak packets</li>
                    <li>Monitor humidity twice daily</li>
                </ol>

                <h4 style="font-weight: 600; margin-top: 16px; margin-bottom: 8px;">Next Step:</h4>
                <p>If lifting persists after 48 hours with low humidity, schedule professional inspection with Taylor-authorized tech immediately. Bridge regluing cost: $150-200.</p>

                <h4 style="font-weight: 600; margin-top: 16px; margin-bottom: 8px;">String Tension Check:</h4>
                <p>If not already done, consider switching to EJ16 Light (.012-.053) strings to reduce neck/top stress. Multiple techs report all GS Minis they repaired for bridge lift were on mediums long-term.</p>
            </div>
            <button id="closeBridgeModal" class="btn-primary" style="width: 100%; margin-top: 16px;">Understood</button>
        </div>
    </div>

    <div id="actionModal" class="modal">
        <div class="modal-content">
            <button id="closeActionModalX" class="modal-close">&times;</button>
            <div class="modal-header">üîß Action or Buzzing Issues Detected</div>
            <div style="font-size: 13px; color: var(--color-text-light); line-height: 1.6;">
                <h4 style="font-weight: 600; margin-bottom: 8px;">High Action Issues:</h4>
                <ul style="padding-left: 20px; margin-bottom: 12px;">
                    <li>If high E &gt; 2.5mm or low E &gt; 3mm at 12th fret, string height is above GS Mini spec</li>
                    <li>Possible causes: neck bowing (humidity), bridge movement, or improper setup</li>
                    <li>Solution: Professional truss rod adjustment ($75-115)</li>
                </ul>

                <h4 style="font-weight: 600; margin-bottom: 8px;">Buzzing Issues:</h4>
                <ul style="padding-left: 20px; margin-bottom: 12px;">
                    <li>Consistent buzzing across multiple frets = likely neck relief issue</li>
                    <li>Buzzing on only 1-2 frets = possible fret sprout from humidity changes</li>
                    <li>Solution: Bring to tech for fret straightness assessment</li>
                </ul>

                <h4 style="font-weight: 600; margin-bottom: 8px;">Dead Spots:</h4>
                <ul style="padding-left: 20px;">
                    <li>Uneven sustain or sudden drop in specific areas = action or neck alignment issue</li>
                    <li>Solution: Schedule with Taylor-experienced luthier for diagnosis</li>
                </ul>

                <p style="margin-top: 16px; padding: 12px; background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--color-warning); border-radius: 4px;">
                    <strong>GS Mini-specific note:</strong> The <span class="gs-mini-spec" title="Taylor GS Mini specification">23.5" scale length</span> requires specific setup parameters. Ensure your tech is familiar with GS Minis for optimal results.
                </p>
            </div>
            <button id="closeActionModal" class="btn-primary" style="width: 100%; margin-top: 16px;">Got It</button>
        </div>
    </div>

    <div id="fretModal" class="modal">
        <div class="modal-content">
            <button id="closeFretModalX" class="modal-close">&times;</button>
            <div class="modal-header">‚ú® Fret Condition Issues Detected</div>
            <div style="font-size: 13px; color: var(--color-text-light); line-height: 1.6;">
                <h4 style="font-weight: 600; margin-bottom: 8px;">Rough or Gritty Frets:</h4>
                <ul style="padding-left: 20px; margin-bottom: 12px;">
                    <li>Indicates tarnish or oxidation from finger oils</li>
                    <li>Tarnished frets damage strings 3-5x faster and cause string degradation</li>
                    <li>Solution: Use FRINE Kit with fretboard guards to polish tarnished frets (15-20 min)</li>
                </ul>

                <h4 style="font-weight: 600; margin-bottom: 8px;">Dull Appearance:</h4>
                <ul style="padding-left: 20px; margin-bottom: 12px;">
                    <li>Loss of mirror shine indicates corrosion buildup</li>
                    <li>This accelerates string wear and affects feel/response</li>
                    <li>Solution: Schedule FRINE polishing at next string change</li>
                </ul>

                <h4 style="font-weight: 600; margin-bottom: 8px;">Fret Sprout (Sharp Edges):</h4>
                <ul style="padding-left: 20px;">
                    <li>Sharp fret ends protruding from fingerboard edges = neck shrinking from low humidity</li>
                    <li>Low humidity (below 40%) causes wood contraction and fret protrusion</li>
                    <li>Solution: Increase humidity to 45-50% with Humidipak + room humidifier</li>
                    <li>If excessive: Professional fret dressing/leveling ($200-400)</li>
                </ul>

                <p style="margin-top: 16px; padding: 12px; background: rgba(16, 185, 129, 0.1); border-left: 4px solid var(--color-success); border-radius: 4px;">
                    <strong>Preventive note:</strong> Your FRINE Kit is designed specifically for this. Regular quarterly polishing prevents excessive buildup and extends fret life.
                </p>
            </div>
            <button id="closeFretModal" class="btn-primary" style="width: 100%; margin-top: 16px;">Thanks</button>
        </div>
    </div>

    <!-- HUMIDITY TREND INFO MODAL -->
    <div id="humidityTrendModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <button id="closeHumidityTrendModal" class="modal-close">&times;</button>
            <div class="modal-header">Why Rapid Humidity Changes Matter</div>
            <div style="font-size: 14px; line-height: 1.6;">
                <p style="margin-bottom: 12px;">Rapid humidity changes stress guitar wood and can cause serious damage:</p>
                <div style="background: var(--color-bg); padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">Change Severity:</div>
                    <div style="display: flex; flex-direction: column; gap: 6px; font-size: 13px;">
                        <div><span style="color: var(--color-success); font-weight: 600;">‚Üë‚Üì &lt;5% in 24h:</span> Normal variation (safe)</div>
                        <div><span style="color: var(--color-warning); font-weight: 600;">‚Üë‚Üì 5-10% in 24h:</span> Moderate stress (caution)</div>
                        <div><span style="color: var(--color-error); font-weight: 600;">‚Üë‚Üì &gt;10% in 24h:</span> High stress (danger)</div>
                    </div>
                </div>
                <div style="background: rgba(239, 68, 68, 0.1); border-left: 4px solid var(--color-error); padding: 12px; border-radius: 4px; margin-bottom: 12px;">
                    <strong>‚ö†Ô∏è Potential Damage:</strong>
                    <ul style="margin-top: 8px; padding-left: 20px; font-size: 13px;">
                        <li>Finish cracking</li>
                        <li>Glue joint stress</li>
                        <li>Bridge movement or lifting</li>
                        <li>Fret sprout from wood expansion/contraction</li>
                    </ul>
                </div>
                <div style="background: rgba(16, 185, 129, 0.1); border-left: 4px solid var(--color-success); padding: 12px; border-radius: 4px;">
                    <strong>‚úÖ Prevention:</strong>
                    <p style="margin-top: 8px; font-size: 13px;">Keep your guitar in its case with Humidipak when not playing. The case buffers environmental changes and keeps humidity stable.</p>
                </div>
            </div>
            <button id="closeHumidityTrendBtn" class="btn-primary" style="width: 100%; margin-top: 16px;">Got It</button>
        </div>
    </div>

    <!-- STRING BRAND PROMPT MODAL -->
    <div id="stringBrandModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <button id="closeStringBrandModal" class="modal-close">&times;</button>
            <div class="modal-header">‚úÖ String Change Logged!</div>
            <p style="font-size: 14px; color: var(--color-text-light); margin-bottom: 16px;">Record string details (optional)</p>
            <div class="form-group">
                <label class="form-label">String Brand/Type</label>
                <input type="text" id="stringBrandInput" placeholder="e.g., D'Addario EJ16, Elixir Nanoweb" style="width: 100%;">
            </div>
            <div class="form-group" style="margin-top: 12px;">
                <label class="form-label">Notes (optional)</label>
                <textarea id="stringNotesInput" placeholder="e.g., Felt stiff for 2 days, Love these strings, Sound great" style="width: 100%; min-height: 60px; resize: vertical; font-family: inherit; font-size: 14px; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px; background: var(--color-surface); color: var(--color-text);"></textarea>
            </div>
            <div class="button-group" style="margin-top: 16px;">
                <button class="btn-secondary" onclick="saveStringChange(null, null)">Skip</button>
                <button class="btn-primary" onclick="saveStringChangeBrand()">Save</button>
            </div>
        </div>
    </div>

    <!-- PLAYING SESSION DURATION MODAL -->
    <div id="sessionDurationModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <button id="closeSessionModal" class="modal-close">&times;</button>
            <div class="modal-header">How long did you play?</div>
            <p style="font-size: 13px; color: var(--color-text-light); margin-bottom: 16px;">This helps calculate accurate string life and maintenance needs.</p>
            <div class="duration-options">
                <button class="duration-btn" onclick="logSessionWithDuration(15)">
                    <span class="duration-time">15 min</span>
                    <span class="duration-label">Quick practice</span>
                </button>
                <button class="duration-btn" onclick="logSessionWithDuration(30)">
                    <span class="duration-time">30 min</span>
                    <span class="duration-label">Short session</span>
                </button>
                <button class="duration-btn" onclick="logSessionWithDuration(60)">
                    <span class="duration-time">1 hour</span>
                    <span class="duration-label">Standard session</span>
                </button>
                <button class="duration-btn" onclick="logSessionWithDuration(120)">
                    <span class="duration-time">2+ hours</span>
                    <span class="duration-label">Long session</span>
                </button>
            </div>
        </div>
    </div>

    <!-- INVENTORY MODAL -->
    <div id="inventoryModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <button onclick="window.hideInventoryModal()" class="modal-close">&times;</button>
            <div class="modal-header" id="inventoryModalTitle">Add Inventory Item</div>

            <form id="inventoryForm" onsubmit="event.preventDefault(); window.saveInventoryFromForm();">
                <div class="form-group">
                    <label class="form-label">Item Name</label>
                    <input type="text" id="inventoryName" placeholder="e.g., D'Addario EJ16" required style="width: 100%;">
                </div>

                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select id="inventoryCategory" style="width: 100%;">
                        <option value="strings">Strings</option>
                        <option value="picks">Picks</option>
                        <option value="cleaning">Cleaning</option>
                        <option value="humidification">Humidification</option>
                        <option value="batteries">Batteries</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Current Count</label>
                    <input type="number" id="inventoryCount" min="0" value="0" style="width: 100%;">
                </div>

                <div class="form-group">
                    <label class="form-label">Restock Threshold</label>
                    <input type="number" id="inventoryThreshold" min="0" value="1" style="width: 100%;">
                    <div style="font-size: 11px; color: var(--color-text-light); margin-top: 4px;">You'll get an alert when count reaches this level</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Link to Task (optional)</label>
                    <select id="inventoryLinkedTask" style="width: 100%;">
                        <option value="">None</option>
                        <option value="8w-8">String Change (8-week)</option>
                        <option value="q-1">Humidipak Replacement (Quarterly)</option>
                        <option value="daily-1">String Cleaning (Daily)</option>
                    </select>
                    <div style="font-size: 11px; color: var(--color-text-light); margin-top: 4px;">Auto-prompt to decrement when task is completed</div>
                </div>

                <div class="button-group" style="margin-top: 20px;">
                    <button type="button" class="btn-secondary" onclick="window.hideInventoryModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ONBOARDING MODAL -->
    <div id="onboardingModal" class="modal onboarding-modal">
        <div class="modal-content onboarding-content">
            <button id="closeOnboarding" class="modal-close" title="Skip setup">&times;</button>

            <!-- Step Indicator -->
            <div class="onboarding-steps">
                <div class="step-dot active" data-step="0"></div>
                <div class="step-dot" data-step="1"></div>
                <div class="step-dot" data-step="2"></div>
                <div class="step-dot" data-step="3"></div>
            </div>

            <!-- Step 0: Welcome -->
            <div class="onboarding-step active" data-step="0">
                <h2>üé∏ Welcome to Guitar Tracker</h2>
                <p>Keep your Taylor GS Mini in perfect condition with guided maintenance tracking.</p>
                <p style="margin-top: 16px; color: var(--color-text-light);">Let's get you set up in 3 quick steps.</p>
                <div class="onboarding-actions">
                    <button class="btn-secondary" onclick="skipOnboarding()">Skip Setup</button>
                    <button class="btn-primary" onclick="nextOnboardingStep()">Get Started ‚Üí</button>
                </div>
            </div>

            <!-- Step 1: String Change Date -->
            <div class="onboarding-step" data-step="1">
                <h2>When did you last change strings?</h2>
                <p style="color: var(--color-text-light); margin-bottom: 16px;">This helps us calculate when your next string change is due.</p>
                <div class="form-group">
                    <label class="form-label">Last String Change Date</label>
                    <input type="date" id="onboardingStringDate" style="width: 100%;">
                </div>
                <div class="onboarding-actions">
                    <button class="btn-secondary" onclick="previousOnboardingStep()">‚Üê Back</button>
                    <button class="btn-secondary" onclick="skipStringDate()">I Don't Remember</button>
                    <button class="btn-primary" onclick="nextOnboardingStep()">Next ‚Üí</button>
                </div>
            </div>

            <!-- Step 2: Playing Frequency -->
            <div class="onboarding-step" data-step="2">
                <h2>How often do you play?</h2>
                <p style="color: var(--color-text-light); margin-bottom: 16px;">This helps us adjust maintenance schedules and string life calculations.</p>
                <div class="form-group">
                    <label class="form-label">Playing Frequency</label>
                    <select id="onboardingPlayingFrequency" style="width: 100%;">
                        <option value="daily">Daily (6-7 days/week) ‚Äî ~7 hrs/week</option>
                        <option value="fewTimesWeek">A few times a week (3-5 days) ‚Äî ~4 hrs/week</option>
                        <option value="weekly" selected>Weekly (1-2 days) ‚Äî ~2.5 hrs/week</option>
                        <option value="occasionally">Occasionally (few times/month) ‚Äî ~1 hr/week</option>
                    </select>
                </div>
                <div class="onboarding-actions">
                    <button class="btn-secondary" onclick="previousOnboardingStep()">‚Üê Back</button>
                    <button class="btn-primary" onclick="nextOnboardingStep()">Next ‚Üí</button>
                </div>
            </div>

            <!-- Step 3: Hygrometer -->
            <div class="onboarding-step" data-step="3">
                <h2>Do you have a hygrometer?</h2>
                <p style="color: var(--color-text-light); margin-bottom: 16px;">A hygrometer measures humidity to prevent guitar damage. This is critical for solid-top guitars like the GS Mini.</p>
                <div class="onboarding-yn-buttons">
                    <button class="btn-yn" onclick="setHasHygrometer(true)">‚úì Yes, I have one</button>
                    <button class="btn-yn" onclick="setHasHygrometer(false)">‚úó No, I don't</button>
                </div>
                <div id="hygrometerRecommendation" style="display: none; margin-top: 16px; padding: 12px; background: rgba(239, 68, 68, 0.1); border-left: 4px solid var(--color-error); border-radius: 4px; font-size: 13px;">
                    <strong>‚ö†Ô∏è Highly Recommended:</strong> Get a hygrometer like the Inkbird ITH-10 ($10-15). Bridge lifting from high humidity causes $150-200 repairs. Your Humidipak needs monitoring to work effectively.
                </div>
                <div class="onboarding-actions" style="margin-top: 20px;">
                    <button class="btn-secondary" onclick="previousOnboardingStep()">‚Üê Back</button>
                    <button class="btn-primary" id="finishOnboarding" onclick="completeOnboarding()" disabled>Finish Setup</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>
